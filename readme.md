# Проект Coffee Service

## Обзор
Этот проект — система управления кофе-сервисом, включающая функционал для управления пользователями, бронирования столов, создания заказов, обработки платежей, оставления отзывов и многое другое. Система поддерживает несколько ролей пользователей: **ADMIN**, **WAITER** и **VISITOR**, каждая из которых имеет разные уровни доступа.

## Сущности

### 1. **User (Пользователь)**
Представляет пользователя в системе. Содержит:
- `id`: Уникальный идентификатор (автоматически генерируется).
- `firstName`: Имя пользователя.
- `lastName`: Фамилия пользователя.
- `email`: Электронная почта пользователя (уникальна).
- `role`: Роль пользователя (например, `VISITOR`, `WAITER`, `ADMIN`).
- `password`: Пароль пользователя для аутентификации.
- `phone`: Телефон пользователя.
- `locked`: Флаг, который указывает, заблокирован ли аккаунт пользователя.

### 2. **Booking (Бронирование)**
Представляет бронирование стола пользователем. Содержит:
- `id`: Уникальный ID бронирования.
- `user`: Пользователь, который сделал бронирование (Связь многие к одному с User).
- `desk`: Стол, который был забронирован (Связь многие к одному с Desk).
- `startDate`: Время начала бронирования.
- `endDate`: Время окончания бронирования.
- `status`: Статус бронирования (например, "CONFIRMED").

### 3. **Desk (Стол)**
Представляет стол в кафе. Содержит:
- `id`: Уникальный ID стола.
- `deskNumber`: Номер стола (идентификатор).
- `capacity`: Вместимость стола (сколько людей может разместиться).
- `location`: Местоположение стола (например, "у окна").

### 4. **Order (Заказ)**
Представляет заказ, сделанный пользователем. Содержит:
- `id`: Уникальный ID заказа.
- `food`: Блюдо, которое связано с заказом (Связь многие к одному с Food).
- `orderDetails`: Детали заказа (Связь многие к одному с OrderDetails).
- `quantity`: Количество заказанного блюда.

### 5. **OrderDetails (Детали заказа)**
Хранит информацию, связанную с конкретным заказом:
- `id`: Уникальный ID деталей заказа.
- `booking`: Бронирование, с которым связан этот заказ (Связь многие к одному с Booking).
- `amount`: Общая сумма заказа.
- `status`: Статус заказа (например, "PENDING", "COMPLETED").

### 6. **PaymentSession (Платежная сессия)**
Представляет сессию платежа, связанную с транзакцией:
- `id`: Уникальный ID сессии платежа.
- `fullName`: Имя пользователя, который совершил платеж.
- `email`: Электронная почта пользователя.
- `description`: Описание сессии платежа.
- `orderDate`: Дата заказа.
- `amount`: Сумма платежа.
- `transaction`: Транзакция, связанная с этим платежом.

### 7. **Transaction (Транзакция)**
Представляет транзакцию, связанную с платежом:
- `id`: Уникальный ID транзакции.
- `status`: Статус транзакции (например, "IN_PROCESS", "COMPLETED").

### 8. **Promotion (Акция)**
Представляет акцию:
- `id`: Уникальный ID акции.
- `name`: Название акции.
- `description`: Описание акции.
- `startDate`: Дата начала акции.
- `endDate`: Дата окончания акции.

### 9. **Review (Отзыв)**
Представляет отзыв, оставленный пользователем о продукте или услуге:
- `id`: Уникальный ID отзыва.
- `user`: Пользователь, оставивший отзыв (Связь многие к одному с User).
- `rating`: Оценка, оставленная пользователем (например, от 1 до 5).
- `reviewText`: Текст отзыва.
- `reviewDate`: Дата создания отзыва.

### 10. **UserAccount (Учётная запись пользователя)**
Представляет баланс пользователя:
- `id`: Уникальный ID учётной записи.
- `user`: Пользователь, связанный с этой учётной записью (Связь многие к одному с User).
- `balance`: Баланс учётной записи пользователя.

## Контроллеры

### 1. **UserController**
Управляет пользователями:
- **POST /users/create**: Регистрация нового пользователя.
- **GET /users/**: Получить всех пользователей (только для админа).
- **GET /users/{id}**: Получить пользователя по ID (только для админа).
- **PUT /users/update**: Обновить профиль пользователя.
- **DELETE /users/delete/{id}**: Удалить пользователя (только для админа).
- **GET /users/search**: Поиск пользователей по имени, фамилии или email.

### 2. **BookingController**
Управляет бронированиями:
- **GET /bookings/**: Получить все бронирования (только для админа).
- **GET /bookings/user**: Получить бронирования для текущего пользователя.
- **POST /bookings/create**: Создать новое бронирование.
- **PUT /bookings/update/{id}**: Обновить бронирование (только для владельца).
- **DELETE /bookings/delete/{id}**: Удалить бронирование (только для владельца).

### 3. **DeskController**
Управляет столами:
- **GET /desks/**: Получить все столы.
- **POST /desks/create**: Создать новый стол (только для админа).
- **PUT /desks/update/{id}**: Обновить данные стола (только для админа).
- **DELETE /desks/delete/{id}**: Удалить стол (только для админа).

### 4. **OrderController**
Управляет заказами:
- **GET /orders/**: Получить все заказы (только для админа).
- **POST /orders/create**: Создать новый заказ.
- **PUT /orders/update/{id}**: Обновить заказ.
- **DELETE /orders/delete/{id}**: Удалить заказ.

### 5. **PaymentController**
Управляет процессом оплаты:
- **POST /payment/process**: Обрабатывает платеж за заказ.

### 6. **ReviewController**
Управляет отзывами пользователей:
- **GET /reviews/**: Получить все отзывы.
- **POST /reviews/create**: Создать новый отзыв.
- **DELETE /reviews/delete/{id}**: Удалить отзыв.

### 7. **AdminController**
Управление административными задачами:
- **GET /admin/bookings**: Получить все бронирования.
- **GET /admin/desks**: Получить все столы.
- **GET /admin/users**: Получить всех пользователей.
- **POST /admin/addUser**: Добавить нового пользователя (только для админа).
- **PUT /admin/updateUser/{id}**: Обновить данные пользователя (только для админа).
- **DELETE /admin/deleteUser/{id}**: Удалить пользователя (только для админа).
- **PUT /admin/blockUser/{id}**: Заблокировать пользователя (только для админа).
- **PUT /admin/unblockUser/{id}**: Разблокировать пользователя (только для админа).

### 8. **WaiterController**
Операции для официантов:
- **PUT /waiter/confirm/{id}**: Изменить статус бронирования на "CONFIRMED".

## Сервисы

### 1. **UserService**
Обрабатывает операции с пользователями:
- Создание, обновление, удаление пользователей.
- Поиск пользователей по имени, фамилии, email или телефону.
- Получение информации о пользователе.

### 2. **BookingService**
Обрабатывает операции с бронированиями:
- Создание, обновление, удаление бронирований.
- Проверка доступности стола перед бронированием.

### 3. **DeskService**
Обрабатывает операции с столами:
- Создание, обновление, удаление столов.
- Получение доступных столов для бронирования.

### 4. **OrderService**
Обрабатывает операции с заказами:
- Создание, обновление, удаление заказов.
- Расчёт общей стоимости заказа.

### 5. **PaymentService**
Обрабатывает процесс оплаты:
- Проверка баланса пользователя.
- Создание транзакций и платёжных сессий.
- Обновление статуса транзакции.

### 6. **ReviewService**
Обрабатывает операции с отзывами:
- Создание, удаление и модерация отзывов.

### 7. **AdminService**
Обрабатывает административные операции:
- Управление пользователями, столами, бронированиями и отзывами.
- Назначение ролей пользователям.

## Как работает процесс оплаты
1. Пользователь делает бронирование через **BookingController** и создаёт заказ через **OrderController**.
2. Пользователь переходит к **PaymentController** для совершения оплаты.
3. **PaymentService** проверяет баланс, обрабатывает платёж и обновляет статус транзакции.
4. Создаётся **PaymentSession**, которая хранит информацию о платёжной сессии.

## Запуск проекта

1. Клонируйте репозиторий.
2. Построите и запустите приложение с помощью вашего IDE или с использованием Maven/Gradle.
3. Запустите сервер и используйте Postman для отправки API-запросов.

### Примерные эндпоинты:
- **POST /account/register** – Регистрация нового пользователя.
- **POST /account/login** – Вход для получения JWT токена.
- **POST /bookings/create** – Создание нового бронирования.
- **POST /orders/create** – Создание нового заказа.
- **POST /pay/process** – Обработка платежа за заказ.
